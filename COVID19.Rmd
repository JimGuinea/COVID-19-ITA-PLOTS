---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
actual_date<-Sys.Date()

date_strings = c(as.Date("2020-02-24"), actual_date)
datetimes = strptime(date_strings, format = "%Y-%m-%d") 
datetimes
days = difftime(as.Date(datetimes[2]), as.Date(datetimes[1]), units = c("days"))+1 # days
days
```


```{r}

library(readr)
df <- read_csv("dpc-covid19-ita-andamento-nazionale.csv", col_types = cols(data = col_date(format = "%Y-%m-%d %H:%M:%S"))) 

df    
```

```{r}
df_linea <- data.frame(a = c(0,1000),b= 0.704)
```


```{r}
library(ggplot2)
plot_title_ITA_Log <- paste("COVID19 ITA Log", actual_date)

slope<- 0.0322*4/(4*365+1)
int <- 18316 -slope*as.integer(df[1,]$data)

plot_ITA_All_Log<- ggplot(df, aes(data, totale_casi)) + 
  geom_line(aes(y = ricoverati_con_sintomi, colour = "Ricoverati con Sintomi")) +
  geom_line(aes(y = terapia_intensiva, colour = "Terapia Intensiva")) + 
  geom_line(aes(y = totale_ospedalizzati, colour = "Totale Osp.")) +
  geom_line(aes(y = isolamento_domiciliare, colour = "Isol. Domic.")) +
  geom_line(aes(y = totale_attualmente_positivi, colour = "Totale Attualmente Positivi")) +
  geom_line(aes(y = nuovi_attualmente_positivi, colour = "Nuovi Attualmente Positivi")) +
  geom_line(aes(y = totale_casi, colour = "Totale Casi")) +
  geom_line(aes(y = tamponi/100, colour = "Tamponi (x100)")) +
  scale_x_date(date_breaks = "2 day", date_labels = "%m-%d")+
  theme(axis.text.x=element_text(angle=45, vjust=0.5), legend.position = "top")+
  labs(color = "",y="Numero casi", x = "Data (mese-giorno)", title = plot_title_ITA_Log)+
  scale_y_log10()+
  geom_abline(a=15, b=15, col="blue")+
  annotation_logticks(sides="lr") 
plot_ITA_All_Log
```

```{r}
plot_title_ITA <- paste("COVID19 ITA", actual_date)

plot_ITA<- ggplot(df) + 
  geom_line(aes(y = nuovi_attualmente_positivi, x=data, colour = "Nuovi Attualmente Positivi")) +
  geom_line(aes(y = totale_casi,x=data, colour = "Totale Casi")) +
  scale_x_date(date_breaks = "2 day", date_labels = "%m-%d")+
  geom_text(aes(y = nuovi_attualmente_positivi,x=data,label = round(nuovi_attualmente_positivi, 1), vjust = -1, hjust =0.5 , show.legend = FALSE, colour="Nuovi Attualmente Positivi"))+
  geom_text(aes(y = totale_casi,x=data,label = round(totale_casi, 1), vjust = -2, hjust = 1, show.legend = FALSE, colour="Totale Casi"))+
  ylim(c(0,max(df$totale_casi+1000)))+
  theme(axis.text.x=element_text(angle=45, vjust=0.5), legend.position = "top")+
  labs(color = "", y="Numero casi", x = "Data (mese-giorno)", title = plot_title_ITA)
plot_ITA
```

```{r}
plot_title_ITA_Log <- paste("COVID19 ITA (LogY)", actual_date)

plot_ITA_Log<- ggplot(df) + 
  geom_line(aes(y = nuovi_attualmente_positivi, x=data, colour = "Nuovi Attualmente Positivi")) +
  geom_line(aes(y = totale_casi,x=data, colour = "Totale Casi")) +
  scale_x_date(date_breaks = "2 day", date_labels = "%m-%d")+
  geom_text(aes(y = nuovi_attualmente_positivi,x=data,label = round(nuovi_attualmente_positivi, 1), vjust = 1.5, hjust =+0.5 , colour="Nuovi Attualmente Positivi"))+
  geom_text(aes(y = totale_casi,x=data,label = round(totale_casi, 1), vjust = -0.25, hjust = 1, show.legend = FALSE, colour="Totale Casi"))+
  ylim(c(0,max(df$totale_casi+1000)))+
  theme(axis.text.x=element_text(angle=45, vjust=0.5), legend.position = "top")+
  labs(color = "", y="Numero casi (Log)", x = "Data (mese-giorno)", title = plot_title_ITA_Log)+
  scale_y_log10()+
  annotation_logticks(sides="lr") 
plot_ITA_Log
```
```{r}
df_RAP <- NULL
```

```{r}

ITA_POP <- 60480000
df_RAP <- data.frame(matrix(ncol = 8, nrow = days))
df_RAP_colnames <- c("data", "Deceduti/Tot Casi", "Tot Casi/Tamponi", "Tot Osp/Tot Casi", "Tot Casi/Pop Ita", "Tamponi/Pop Ita", "Terapia Int/Tot Casi", "Dimessi Guariti/Tot Casi" )
colnames(df_RAP) <- df_RAP_colnames
```


```{r}
df_RAP[1] <- data.frame(df[1])
df_RAP[2]<- data.frame(df[10]/df[11])*100
df_RAP[3] <- data.frame(df[11]/df[12])*100
df_RAP[4]<- data.frame(df[5]/df[11])*100
df_RAP[5]<- data.frame(df[11]/ITA_POP)*100
df_RAP[6] <- data.frame(df[12]/ITA_POP)*100
df_RAP[7] <- data.frame(df[4]/df[11])*100
df_RAP[8] <- data.frame(df[9]/df[11])*100
colnames(df_RAP)[1:8] <- df_RAP_colnames
```

```{r}
plot_title_ITA_rap <- paste("COVID19 ITA", actual_date)

plot_ITA_rap <- ggplot(df_RAP, aes(data, percentuale)) + 
  geom_line(aes(y = df_RAP$'Deceduti/Tot Casi', colour = 'Deceduti/Tot Casi')) +
  geom_line(aes(y = df_RAP$'Tot Casi/Tamponi', colour = 'Tot Casi/Tamponi')) +
  geom_line(aes(y = df_RAP$'Terapia Int/Tot Casi', colour = 'Terapia Int/Tot Casi')) +
  geom_line(aes(y = df_RAP$'Dimessi Guariti/Tot Casi', colour = 'Dimessi Guariti/Tot Casi'))+
  scale_x_date(date_breaks = "2 day", date_labels = "%m-%d")+
  theme(axis.text.x=element_text(angle=45, vjust=0.5), legend.position = "top")+
  labs(color = "", y="Percentuale (%)", x = "Data (mese-giorno)", title = plot_title_ITA_rap)
plot_ITA_rap
```

```{r}
plot_POP_ITA_rap <- ggplot(df_RAP, aes(data, percentuale)) + 
  geom_line(aes(y = df_RAP$'Tot Casi/Pop Ita', colour = 'Tot Casi/Pop Ita'))+
  geom_line(aes(y = df_RAP$'Tamponi/Pop Ita', colour = 'Tamponi/Pop Ita'))+
  scale_x_date(date_breaks = "2 day", date_labels = "%m-%d")+
  theme(axis.text.x=element_text(angle=45, vjust=0.5), legend.position = "top")+
  labs(color = "", y="Percentuale (%)", x = "Data (mese-giorno)", title = plot_title)

plot_POP_ITA_rap
```

```{r}

jpeg("COVID19_ITA_plot_1.jpg", width = 750, height = 574)
plot_ITA_All_Log
dev.off()

jpeg("COVID19_ITA_plot_2.jpg", width = 750, height = 574)
plot_ITA
dev.off()

jpeg("COVID19_ITA_plot_3.jpg", width = 750, height = 574)
plot_ITA_Log
dev.off()

jpeg("COVID19_ITA_plot_4.jpg", width = 750, height = 574)
plot_ITA_rap
dev.off()

jpeg("COVID19_ITA_plot_5.jpg", width = 750, height = 574)
plot_POP_ITA_rap
dev.off()
```

